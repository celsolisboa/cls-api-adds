### CLS-ALUNO ####################################################
image: python:jessie

before_script: #Global script (Run before each stage)
- apt-get update --quiet --yes

stages:
- deploy

### BUILD ####################################################
deploy-job-production:
  script:
  - apt-get install --quiet python-pip zip --yes
  - pip install -U pip  # pip update
  - pip install awscli  # AWS CLI installation
  - zip cls-aluno-prod.zip -r ./
  - aws s3 cp cl-alumniad-api.zip $AWS_S3_LOCATION/production/cls-aluno/cls-aluno-prod.zip # Uploads the zipfile to S3 and expects the AWS Code Pipeline/Code Deploy to pick up
  # requires previous CI stages to succeed in order to execute
  when: on_success
  stage: deploy
  environment: production #Assign the Gitlab Environment for tracking purposes
  only:
  - master

deploy-job-developer:
  image: python:jessie
  script:
  - apt-get install --quiet zip --yes
  - pip install -U pip  # pip update
  - pip install awscli  # AWS CLI installation
  - mv ./appspec.yml ./appspec-prod.yml
  - mv ./appspec-dev.yml ./appspec.yml
  - zip cls-aluno-dev.zip -r ./www/ appspec.yml
  - aws s3 cp cls-aluno-dev.zip $AWS_S3_LOCATION/developer/cls-aluno/cls-aluno-dev.zip # Uploads the zipfile to S3 and expects the AWS Code Pipeline/Code Deploy to pick up
  # requires previous CI stages to succeed in order to execute
  when: on_success
  stage: deploy
  environment: developer #Assign the Gitlab Environment for tracking purposes
  only:
  - develop
  - feature/cicd

